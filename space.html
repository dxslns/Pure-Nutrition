<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PWBVFG5DVZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-PWBVFG5DVZ');
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>My Space</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <!-- Внешние стили -->
    <link rel="stylesheet" href="space.css" />
    <style>
        :root {
            --primary-color: #000;
            --secondary-color: #000;
            --accent-color: #000;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
            /* Notion-like */
            --notion-bg: #f7f7f7;
            --notion-text: #37352f;
            --notion-border: #e0e0e0;
            --notion-button-bg: #e0e0e0;
            --notion-button-hover: #d0d0d0;
            --notion-red: #f66;
            --notion-green: #27ae60;
            --notion-blue: #3082fc;
            --notion-yellow: #ff8b47;
            --notion-purple: #9b51e0;
        }

             * {
                 box-sizing: border-box;
                 margin: 0;
                 padding: 0;
             }

             body {
                 font-family: 'Roboto',sans-serif;
                 line-height: 1.6;
                 color: var(--dark-color);
                 background-image: url('\PNGs/pic2.png');
                 background-size: cover;
                 background-position: center;
                 background-repeat: no-repeat;
                 padding: 0;
                 width: 100vw;
                 overflow-x: hidden;
                 display: flex;
                 justify-content: center;
                 align-items: flex-start;
                 min-height: 100vh;
                 margin: 0;
             }

             h1 {
                 text-align: center;
                 margin-bottom: 30px;
                 color: var(--primary-color);
                 font-weight: 700;
             }

             .section {
                 margin: 10px auto;
                 border-radius: 30px;
                 box-shadow: 0 6px 18px rgba(0,0,0,0.6);
                 background-color: rgba(0,0,0,0.7);
                 padding: 20px;
                 width: calc(100% - 20px);
                 max-width: 1200px;
                 height: auto;
                 overflow-y: auto;
                 -webkit-overflow-scrolling: touch;
             }

             .section-title {
                 font-size: 1.5rem;
                 margin-bottom: 20px;
                 color: azure;
                 border-bottom: 2px solid var(--secondary-color);
                 padding-bottom: 10px;
             }

             /* Calendar */
             .calendar {
                 width: 100%;
             }

             .calendar-header {
                 display: flex;
                 flex-direction: column;
                 gap: 10px;
                 margin-bottom: 15px;
             }

             @media (min-width: 400px) {
                 .calendar-header {
                     flex-direction: row;
                     justify-content: space-between;
                     align-items: center;
                 }
             }

             .calendar-title {
                 font-size: 1.3rem;
                 font-weight: 500;
                 color: azure;
             }

             .calendar-nav {
                 display: flex;
                 gap: 10px;
             }

             .calendar-nav-btn {
                 padding: 5px 10px;
                 border: none;
                 border-radius: var(--border-radius);
                 background-color: var(--primary-color);
                 color: #fff;
                 cursor: pointer;
                 transition: var(--transition);
             }

                 .calendar-nav-btn:hover {
                     background-color: var(--secondary-color);
                 }

             .calendar-grid {
                 display: grid;
                 grid-template-columns: repeat(7,1fr);
                 gap: 5px;
             }

             .calendar-day-header {
                 text-align: center;
                 font-weight: 500;
                 padding: 6px;
                 font-size: .7rem;
                 color: var(--secondary-color);
             }

             @media (min-width:350px) {
                 .calendar-day-header {
                     padding: 8px;
                     font-size: .8rem;
                 }
             }

             .calendar-day {
                 aspect-ratio: 1;
                 background-color: #fff;
                 border-radius: var(--border-radius);
                 box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                 padding: 5px;
                 cursor: pointer;
                 transition: var(--transition);
                 border: 1px solid #000;
             }

             @media (max-width:500px) {
                 .calendar-day {
                     height: 100%;
                 }

                 .day-mood-indicator {
                     visibility: hidden;
                 }
             }

             .calendar-day:hover {
                 box-shadow: 0 4px 8px rgba(0,0,0,0.1);
             }

             .calendar-day-number {
                 font-weight: 500;
                 margin-bottom: 5px;
             }

             .day-mood {
                 width: 100%;
                 margin: 5px 0;
             }

             .day-checkbox {
                 display: flex;
                 align-items: center;
                 margin: 3px 0;
                 font-size: .8rem;
             }

                 .day-checkbox input {
                     margin-right: 5px;
                 }

             .day-note {
                 width: 100%;
                 font-size: .7rem;
                 padding: 3px;
                 border: 1px solid #eee;
                 border-radius: 4px;
                 resize: none;
                 height: 40px;
             }

             /* Modal */
             .modal {
                 display: none;
                 position: fixed;
                 top: 0;
                 left: 0;
                 width: 100%;
                 height: 100%;
                 background-color: rgba(0,0,0,0.5);
                 z-index: 1000;
                 justify-content: center;
                 align-items: center;
             }

             .modal-content {
                 background-color: var(--notion-bg);
                 border-radius: 35px;
                 box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                 padding: 20px;
                 width: 95%;
                 max-width: 600px;
                 max-height: 80vh;
                 overflow-y: auto;
                 color: var(--notion-text);
                 font-family: 'Roboto',sans-serif;
             }

             .modal-header {
                 display: flex;
                 justify-content: space-between;
                 align-items: center;
                 margin-bottom: 20px;
                 border-bottom: 1px solid var(--notion-border);
                 padding-bottom: 15px;
             }

             .modal-title {
                 font-size: 1.5rem;
                 font-weight: 700;
                 color: var(--notion-text);
             }

             .close-modal {
                 background: none;
                 border: none;
                 font-size: 1.8rem;
                 cursor: pointer;
                 color: var(--notion-text);
                 opacity: .6;
                 transition: opacity .2s ease;
             }

                 .close-modal:hover {
                     opacity: 1;
                 }

             .modal-section {
                 margin-bottom: 25px;
                 opacity: 0;
                 transform: translateY(20px);
                 transition: opacity 0.3s ease, transform 0.3s ease;
             }

                 .modal-section.visible {
                     opacity: 1;
                     transform: translateY(0);
                 }

             .modal-section-title {
                 font-size: 1.1rem;
                 font-weight: 600;
                 margin-bottom: 10px;
                 color: var(--notion-text);
             }

             /* Sliders */
             .slider-container {
                 margin-bottom: 15px;
             }

             .slider-label {
                 display: flex;
                 justify-content: space-between;
                 align-items: center;
                 margin-bottom: 8px;
                 font-size: .95rem;
                 color: var(--notion-text);
             }

             input[type="range"] {
                 width: 100%;
                 -webkit-appearance: none;
                 height: 6px;
                 background: var(--notion-border);
                 border-radius: 3px;
                 outline: none;
                 opacity: .7;
                 transition: opacity .2s;
             }

                 input[type="range"]:hover {
                     opacity: 1;
                 }

                 input[type="range"]::-webkit-slider-thumb {
                     -webkit-appearance: none;
                     appearance: none;
                     width: 18px;
                     height: 18px;
                     border-radius: 50%;
                     background: var(--notion-blue);
                     cursor: pointer;
                     box-shadow: 0 1px 3px rgba(0,0,0,0.2);
                 }

                 input[type="range"]::-moz-range-thumb {
                     width: 18px;
                     height: 18px;
                     border-radius: 50%;
                     background: var(--notion-blue);
                     cursor: pointer;
                     box-shadow: 0 1px 3px rgba(0,0,0,0.2);
                 }

             .slider-value {
                 font-weight: 500;
                 color: var(--notion-blue);
             }

             /* Buttons */
             .button-group {
                 display: flex;
                 flex-wrap: wrap;
                 gap: 8px;
                 margin-top: 10px;
             }

             .notion-button {
                 padding: 8px 15px;
                 border: 1px solid var(--notion-border);
                 border-radius: 5px;
                 background-color: var(--notion-button-bg);
                 color: var(--notion-text);
                 font-size: .9rem;
                 cursor: pointer;
                 transition: background-color .2s ease, border-color .2s ease;
                 opacity: 0;
                 transform: scale(0.8);
                 transition: opacity 0.3s ease, transform 0.3s ease, background-color .2s ease, border-color .2s ease;
             }

                 .notion-button.visible {
                     opacity: 1;
                     transform: scale(1);
                 }

                 .notion-button:hover {
                     background-color: var(--notion-button-hover);
                 }

                 .notion-button.selected {
                     background-color: var(--notion-blue);
                     color: #fff;
                     border-color: var(--notion-blue);
                 }

                 /* Semantic coloring:
        Любая кнопка с data-negative="true" при выборе подсвечивается красным,
        чтобы не перечислять все возможные значения. */
                 .notion-button[data-negative="true"].selected {
                     background-color: var(--notion-red);
                     border-color: var(--notion-red);
                     color: #fff;
                 }

                 /* Legacy specific color mappings for Water Intake quick glance */
                 .notion-button[data-value="very-little"].selected {
                     background-color: var(--notion-red);
                     border-color: var(--notion-red);
                     color: #fff;
                 }

                 .notion-button[data-value="little"].selected {
                     background-color: #ff7f50;
                     border-color: #ff7f50;
                     color: #fff;
                 }

                 .notion-button[data-value="enough"].selected {
                     background-color: var(--notion-green);
                     border-color: var(--notion-green);
                     color: #fff;
                 }

                 .notion-button[data-value="much"].selected {
                     background-color: #4682b4;
                     border-color: #4682b4;
                     color: #fff;
                 }

                 .notion-button[data-value="very-much"].selected {
                     background-color: #1e90ff;
                     border-color: #1e90ff;
                     color: #fff;
                 }

             /* Checkboxes (if used later) */
             .checkbox-group {
                 display: flex;
                 flex-direction: column;
                 gap: 10px;
                 margin-top: 10px;
             }

             .notion-checkbox {
                 display: flex;
                 align-items: center;
                 font-size: .95rem;
                 color: var(--notion-text);
                 cursor: pointer;
             }

                 .notion-checkbox input[type="checkbox"] {
                     -webkit-appearance: none;
                     appearance: none;
                     width: 18px;
                     height: 18px;
                     border: 1.5px solid var(--notion-border);
                     border-radius: 4px;
                     margin-right: 10px;
                     cursor: pointer;
                     position: relative;
                     outline: none;
                     transition: background-color .2s ease, border-color .2s ease;
                 }

                     .notion-checkbox input[type="checkbox"]:checked {
                         background-color: var(--notion-blue);
                         border-color: var(--notion-blue);
                     }

                         .notion-checkbox input[type="checkbox"]:checked::before {
                             content: '✓';
                             display: block;
                             color: #fff;
                             font-size: 14px;
                             text-align: center;
                             line-height: 16px;
                             position: absolute;
                             top: 0;
                             left: 0;
                             width: 100%;
                             height: 100%;
                         }

             /* Textarea */
             .notion-textarea {
                 width: 100%;
                 padding: 10px;
                 border: 1px solid var(--notion-border);
                 border-radius: 5px;
                 resize: vertical;
                 min-height: 80px;
                 font-family: 'Roboto',sans-serif;
                 font-size: .95rem;
                 color: var(--notion-text);
                 background-color: #fff;
                 transition: border-color .2s ease;
                 opacity: 0;
                 transform: translateY(10px);
                 transition: opacity 0.3s ease, transform 0.3s ease, border-color .2s ease;
             }

                 .notion-textarea.visible {
                     opacity: 1;
                     transform: translateY(0);
                 }

                 .notion-textarea:focus {
                     border-color: var(--notion-blue);
                     outline: none;
                 }

             /* Save Button */
             .save-day-btn {
                 width: 100%;
                 padding: 12px 20px;
                 border: none;
                 border-radius: 15px;
                 background-color: var(--notion-blue);
                 color: #fff;
                 font-weight: 600;
                 font-size: 1rem;
                 cursor: pointer;
                 transition: background-color .2s ease;
                 margin-top: 20px;
                 opacity: 0;
                 transform: translateY(20px);
                 transition: opacity 0.3s ease, transform 0.3s ease, background-color .2s ease;
             }

                 .save-day-btn.visible {
                     opacity: 1;
                     transform: translateY(0);
                 }

                 .save-day-btn:hover {
                     background-color: #207bb4;
                 }

             /* Calendar indicators & toasts */
             .day-indicators {
                 display: flex;
                 justify-content: center;
                 gap: -1px;
                 margin-top: -5px;
             }

                 .day-indicators span {
                     font-size: .8em;
                     width: 16px;
                     height: 16px;
                     display: inline-flex;
                     align-items: center;
                     justify-content: center;
                     border-radius: 50%;
                     background-color: rgba(74,111,165,0.1);
                 }

             .indicator-calories {
                 color: var(--success-color);
             }

             .indicator-macros {
                 color: var(--success-color);
             }

             @media (min-width:768px) {
                 .day-indicators {
                     flex-direction: column;
                     gap: 2px;
                 }

                     .day-indicators span {
                         width: auto;
                         height: auto;
                         background: none;
                         font-size: .7em;
                         justify-content: flex-start;
                         padding-left: 2px;
                     }

                 .indicator-calories::before {
                     content: 'Calories: ';
                 }

                 .indicator-macros::before {
                     content: 'Macros: ';
                 }
             }

             #toast-container {
                 position: fixed;
                 top: 10px;
                 left: 50%;
                 transform: translateX(-50%);
                 z-index: 9999;
                 display: flex;
                 flex-direction: column;
                 gap: 10px;
                 width: 320px;
                 pointer-events: none;
             }

             .toast {
                 background-color: #333;
                 color: #fff;
                 padding: 16px 24px;
                 border-radius: 8px;
                 box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                 font-size: 16px;
                 opacity: 0;
                 animation: slideDown .3s forwards, fadeOut .3s forwards 2.7s;
                 pointer-events: auto;
             }

             @keyframes slideDown {
                 from {
                     opacity: 0;
                     transform: translateY(-20px);
                 }

                 to {
                     opacity: 1;
                     transform: translateY(0);
                 }
             }

             @keyframes fadeOut {
                 from {
                     opacity: 1;
                 }

                 to {
                     opacity: 0;
                 }
             }

             /* Sliders gradient baseline (hook for JS if захочешь динамику) */
             .mood-low, .mood-medium, .mood-high,
             .activity-low, .activity-medium, .activity-high {
                 background: linear-gradient(to right, var(--notion-red) 0%, var(--notion-yellow) 50%, var(--notion-green) 100%);
             }
    </style>
</head>
<body>
    <!-- Zone 3: Calendar -->
    <div class="section">
        <h2 class="section-title">Daily Tracking</h2>
        <div class="calendar">
            <div class="calendar-header">
                <div class="calendar-title" id="current-month-year">June 2023</div>
                <div class="calendar-nav">
                    <button class="calendar-nav-btn" id="prev-month">Previous</button>
                    <button class="calendar-nav-btn" id="next-month">Next</button>
                </div>
            </div>

            <div class="calendar-grid" id="calendar-days-header">
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>
            </div>

            <div class="calendar-grid" id="calendar-days">
                <!-- Calendar days will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Day Details Modal -->
    <div class="modal" id="day-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-day-title">Day Details</h3>
                <button class="close-modal">&times;</button>
            </div>

            <!-- Sleep Hours -->
            <div class="modal-section" id="sleep-hours-section">
                <div class="modal-section-title">Sleep Hours</div>
                <div class="slider-container">
                    <label class="slider-label" for="sleep-slider">
                        <span>How much sleep did you get today?</span>
                        <span id="sleep-value" class="slider-value">7.0 hrs</span>
                    </label>
                    <input type="range" id="sleep-slider" min="0" max="14" step="0.1" value="7">
                </div>
            </div>

            <!-- Sleep Quality (new) -->
            <div class="modal-section" id="sleep-quality-section">
                <div class="modal-section-title">Sleep Quality</div>
                <div class="button-group" id="sleep-quality-buttons">
                    <button class="notion-button" data-value="fragmented-sleep" data-negative="true">Fragmented Sleep</button>
                    <button class="notion-button" data-value="went-to-bed-late" data-negative="true">Went to Bed Late</button>
                    <button class="notion-button" data-value="early-wakeup" data-negative="true">Early Wakeup</button>
                </div>
            </div>

            <!-- Water Intake -->
            <div class="modal-section" id="water-intake-section">
                <div class="modal-section-title">Water Intake</div>
                <div class="button-group" id="water-intake-buttons">
                    <button class="notion-button" data-value="very-little" data-negative="true">Very Little</button>
                    <button class="notion-button" data-value="little" data-negative="true">Little</button>
                    <button class="notion-button" data-value="enough">Enough</button>
                    <button class="notion-button" data-value="much">Much</button>
                    <button class="notion-button" data-value="very-much">Very Much</button>
                </div>
            </div>

            <!-- Nutrition (split by subcategories) -->
            <div class="modal-section" id="nutrition-macros-section">
                <div class="modal-section-title">Nutrition — Macros</div>
                <div class="button-group" id="nutrition-macros-buttons">
                    <button class="notion-button" data-value="protein-not-met" data-negative="true">Protein Not Met</button>
                    <button class="notion-button" data-value="calories-not-met" data-negative="true">Calories Not Met</button>
                    <button class="notion-button" data-value="high-carbs" data-negative="true">High Fast Carbs</button>
                </div>
            </div>

            <div class="modal-section" id="nutrition-quality-section">
                <div class="modal-section-title">Nutrition — Quality</div>
                <div class="button-group" id="nutrition-quality-buttons">
                    <button class="notion-button" data-value="unhealthy-food" data-negative="true">Unhealthy Food</button>
                    <button class="notion-button" data-value="late-night-snacking" data-negative="true">Late-Night Snacking</button>
                    <button class="notion-button" data-value="low-fiber" data-negative="true">Low Fiber</button>
                    <button class="notion-button" data-value="low-micronutrients" data-negative="true">Low Micronutrients</button>
                    <button class="notion-button" data-value="low-fruit-veg" data-negative="true">Low Fruit & Veg</button>
                </div>
            </div>

            <div class="modal-section" id="nutrition-stimulants-section">
                <div class="modal-section-title">Nutrition — Stimulants</div>
                <div class="button-group" id="nutrition-stimulants-buttons">
                    <button class="notion-button" data-value="high-caffeine" data-negative="true">High Caffeine</button>
                    <button class="notion-button" data-value="alcohol" data-negative="true">Alcohol</button>
                </div>
            </div>

            <!-- Mood -->
            <div class="modal-section" id="mood-section">
                <div class="modal-section-title">Mood</div>
                <div class="slider-container">
                    <label class="slider-label" for="mood-slider">
                        <span>How did you feel today? (1-10)</span>
                        <span id="mood-value" class="slider-value">5</span>
                    </label>
                    <input type="range" id="mood-slider" min="1" max="10" value="5">
                </div>
            </div>

            <!-- Symptoms (split by categories) -->
            <div class="modal-section" id="symptoms-core-section">
                <div class="modal-section-title">Symptoms — Core</div>
                <div class="button-group" id="symptoms-core-buttons">
                    <button class="notion-button" data-value="stress" data-negative="true">Stress</button>
                    <button class="notion-button" data-value="headache" data-negative="true">Headache</button>
                    <button class="notion-button" data-value="fatigue" data-negative="true">Fatigue</button>
                    <button class="notion-button" data-value="insomnia" data-negative="true">Insomnia</button>
                    <button class="notion-button" data-value="muscle-pain" data-negative="true">Muscle Pain</button>
                </div>
            </div>

            <div class="modal-section" id="symptoms-gi-section">
                <div class="modal-section-title">Symptoms — GI</div>
                <div class="button-group" id="symptoms-gi-buttons">
                    <button class="notion-button" data-value="bloating" data-negative="true">Bloating</button>
                    <button class="notion-button" data-value="heaviness" data-negative="true">Heaviness</button>
                    <button class="notion-button" data-value="constipation" data-negative="true">Constipation</button>
                    <button class="notion-button" data-value="diarrhea" data-negative="true">Diarrhea</button>
                </div>
            </div>

            <div class="modal-section" id="symptoms-immunity-section">
                <div class="modal-section-title">Symptoms — Immunity</div>
                <div class="button-group" id="symptoms-immunity-buttons">
                    <button class="notion-button" data-value="cold" data-negative="true">Cold/Flu</button>
                    <button class="notion-button" data-value="inflammation" data-negative="true">Inflammation</button>
                </div>
            </div>

            <div class="modal-section" id="symptoms-skinhair-section">
                <div class="modal-section-title">Symptoms — Skin & Hair</div>
                <div class="button-group" id="symptoms-skinhair-buttons">
                    <button class="notion-button" data-value="dry-skin" data-negative="true">Dry Skin</button>
                    <button class="notion-button" data-value="acne" data-negative="true">Acne</button>
                    <button class="notion-button" data-value="hair-loss" data-negative="true">Hair Loss</button>
                </div>
            </div>

            <div class="modal-section" id="symptoms-energy-section">
                <div class="modal-section-title">Symptoms — Energy</div>
                <div class="button-group" id="symptoms-energy-buttons">
                    <button class="notion-button" data-value="post-meal-sleepiness" data-negative="true">Post-Meal Sleepiness</button>
                    <button class="notion-button" data-value="morning-grogginess" data-negative="true">Morning Grogginess</button>
                </div>
            </div>

            <div class="modal-section" id="symptoms-mental-section">
                <div class="modal-section-title">Symptoms — Mental/Hormonal</div>
                <div class="button-group" id="symptoms-mental-buttons">
                    <button class="notion-button" data-value="mood-swings" data-negative="true">Mood Swings</button>
                    <button class="notion-button" data-value="irritability" data-negative="true">Irritability</button>
                    <button class="notion-button" data-value="low-libido" data-negative="true">Low Libido</button>
                    <button class="notion-button" data-value="anxiety" data-negative="true">Anxiety</button>
                    <button class="notion-button" data-value="apathy" data-negative="true">Apathy</button>
                </div>
            </div>

            <!-- Activity Level -->
            <div class="modal-section" id="activity-level-section">
                <div class="modal-section-title">Activity Level</div>
                <div class="slider-container">
                    <label class="slider-label" for="activity-slider">
                        <span>How active were you today? (1-10)</span>
                        <span id="activity-value" class="slider-value">5</span>
                    </label>
                    <input type="range" id="activity-slider" min="1" max="10" value="5">
                </div>
            </div>

            <!-- Activity Issues (new) -->
            <div class="modal-section" id="activity-issues-section">
                <div class="modal-section-title">Activity — Issues</div>
                <div class="button-group" id="activity-issues-buttons">
                    <button class="notion-button" data-value="sedentary-day" data-negative="true">Sedentary Day</button>
                    <button class="notion-button" data-value="overtraining" data-negative="true">Overtraining</button>
                    <button class="notion-button" data-value="poor-recovery" data-negative="true">Poor Recovery</button>
                </div>
            </div>

            <!-- Notes -->
            <div class="modal-section" id="notes-section">
                <div class="modal-section-title">Notes</div>
                <textarea class="notion-textarea" id="day-notes" placeholder="Write your notes for the day..."></textarea>
            </div>

            <button class="save-day-btn" id="save-day-btn">Save Day</button>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Current date
            let currentDate = new Date();
            let currentYear = currentDate.getFullYear();
            let currentMonth = currentDate.getMonth();
            let selectedDay = null;

            // DOM Elements for Calendar and Modal
            const currentMonthYear = document.getElementById('current-month-year');
            const calendarDays = document.getElementById('calendar-days');
            const dayModal = document.getElementById('day-modal');
            const modalDayTitle = document.getElementById('modal-day-title');
            const closeModal = document.querySelector('.close-modal');

            // Modal Elements
            const sleepSlider = document.getElementById('sleep-slider');
            const sleepValueDisplay = document.getElementById('sleep-value');

            const waterIntakeButtons = document.getElementById('water-intake-buttons');

            const nutritionMacrosButtons = document.getElementById('nutrition-macros-buttons');
            const nutritionQualityButtons = document.getElementById('nutrition-quality-buttons');
            const nutritionStimulantsButtons = document.getElementById('nutrition-stimulants-buttons');

            const moodSlider = document.getElementById('mood-slider');
            const moodValueDisplay = document.getElementById('mood-value');

            const symptomsCoreButtons = document.getElementById('symptoms-core-buttons');
            const symptomsGIButtons = document.getElementById('symptoms-gi-buttons');
            const symptomsImmunityButtons = document.getElementById('symptoms-immunity-buttons');
            const symptomsSkinHairButtons = document.getElementById('symptoms-skinhair-buttons');
            const symptomsEnergyButtons = document.getElementById('symptoms-energy-buttons');
            const symptomsMentalButtons = document.getElementById('symptoms-mental-buttons');

            const sleepQualityButtons = document.getElementById('sleep-quality-buttons');

            const activitySlider = document.getElementById('activity-slider');
            const activityValueDisplay = document.getElementById('activity-value');
            const activityIssuesButtons = document.getElementById('activity-issues-buttons');

            const dayNotes = document.getElementById('day-notes');
            const saveDayBtn = document.getElementById('save-day-btn');

            // Calendar navigation buttons
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');

            // Toast container
            const toastContainer = document.getElementById('toast-container');

            // Event Listeners
            closeModal.addEventListener('click', () => {
                dayModal.style.display = 'none';
                document.body.style.overflow = '';
            });

            sleepSlider.addEventListener('input', () => {
                sleepValueDisplay.textContent = parseFloat(sleepSlider.value).toFixed(1) + ' hrs';
            });

            moodSlider.addEventListener('input', () => {
                moodValueDisplay.textContent = moodSlider.value;
            });

            activitySlider.addEventListener('input', () => {
                activityValueDisplay.textContent = activitySlider.value;
            });

            // Button groups: water (single), остальные — multi
            waterIntakeButtons.addEventListener('click', (e) => handleButtonClick(e, false));
            [
                nutritionMacrosButtons, nutritionQualityButtons, nutritionStimulantsButtons,
                symptomsCoreButtons, symptomsGIButtons, symptomsImmunityButtons,
                symptomsSkinHairButtons, symptomsEnergyButtons, symptomsMentalButtons,
                sleepQualityButtons, activityIssuesButtons
            ].forEach(group => group.addEventListener('click', (e) => handleButtonClick(e, true)));

            saveDayBtn.addEventListener('click', saveDayData);

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === dayModal) {
                    dayModal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            });

            // Calendar navigation event listeners
            prevMonthBtn.addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) { currentMonth = 11; currentYear--; }
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) { currentMonth = 0; currentYear++; }
                renderCalendar();
            });

            // Initialize
            renderCalendar();

            function handleButtonClick(event, isMultiSelect) {
                const clickedButton = event.target.closest('.notion-button');
                if (!clickedButton) return;
                const group = clickedButton.parentElement;
                const buttons = Array.from(group.children);

                if (isMultiSelect) {
                    clickedButton.classList.toggle('selected');
                } else {
                    buttons.forEach(btn => btn.classList.remove('selected'));
                    clickedButton.classList.add('selected');
                }
            }

            function renderCalendar() {
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                currentMonthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;

                const firstDay = new Date(currentYear, currentMonth, 1).getDay();
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

                calendarDays.innerHTML = '';

                for (let i = 0; i < firstDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day empty';
                    calendarDays.appendChild(emptyDay);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.dataset.day = day;
                    dayElement.dataset.month = currentMonth;
                    dayElement.dataset.year = currentYear;

                    const today = new Date();
                    if (currentYear === today.getFullYear() && currentMonth === today.getMonth() && day === today.getDate()) {
                        dayElement.classList.add('today');
                    }

                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'calendar-day-number';
                    dayNumber.textContent = day;
                    dayElement.appendChild(dayNumber);

                    const dateKey = `${currentYear}-${currentMonth}-${day}`;
                    const dayData = getDayData(dateKey);

                    if (dayData) {
                        if (dayData.mood) {
                            const moodIndicator = document.createElement('div');
                            moodIndicator.className = 'day-mood-indicator';
                            moodIndicator.textContent = `Mood: ${dayData.mood}`;
                            moodIndicator.style.fontSize = '0.7em';
                            moodIndicator.style.color = 'gray';
                            dayElement.appendChild(moodIndicator);
                        }

                        if (dayData.sleep) {
                            const sleepIndicator = document.createElement('div');
                            sleepIndicator.className = 'day-sleep-indicator';
                            sleepIndicator.textContent = `Sleep: ${dayData.sleep} hrs`;
                            sleepIndicator.style.fontSize = '0.7em';
                            sleepIndicator.style.color = 'gray';
                            dayElement.appendChild(sleepIndicator);
                        }

                        if (dayData.water) {
                            const waterIndicator = document.createElement('div');
                            waterIndicator.className = 'day-water-indicator';
                            waterIndicator.textContent = `Water: ${dayData.water}`;
                            waterIndicator.style.fontSize = '0.7em';
                            waterIndicator.style.color = 'gray';
                            dayElement.appendChild(waterIndicator);
                        }

                        if (dayData.activity) {
                            const activityIndicator = document.createElement('div');
                            activityIndicator.className = 'day-activity-indicator';
                            activityIndicator.textContent = `Activity: ${dayData.activity}`;
                            activityIndicator.style.fontSize = '0.7em';
                            activityIndicator.style.color = 'gray';
                            dayElement.appendChild(activityIndicator);
                        }

                        if (dayData.notes) {
                            const notesIndicator = document.createElement('div');
                            notesIndicator.className = 'day-notes-indicator';
                            notesIndicator.textContent = '📝';
                            notesIndicator.style.fontSize = '0.7em';
                            dayElement.appendChild(notesIndicator);
                        }

                        // Indicators for negative symptoms
                        const negativeSymptoms = [
                            ...(dayData.symptomsCore || []),
                            ...(dayData.symptomsGI || []),
                            ...(dayData.symptomsImmunity || []),
                            ...(dayData.symptomsSkinHair || []),
                            ...(dayData.symptomsEnergy || []),
                            ...(dayData.symptomsMental || []),
                            ...(dayData.nutritionMacros || []),
                            ...(dayData.nutritionQuality || []),
                            ...(dayData.nutritionStimulants || []),
                            ...(dayData.sleepQuality || []),
                            ...(dayData.activityIssues || [])
                        ];

                        if (negativeSymptoms.length > 0) {
                            const negativeIndicator = document.createElement('div');
                            negativeIndicator.className = 'day-negative-indicator';
                            negativeIndicator.textContent = '⚠️';
                            negativeIndicator.style.fontSize = '0.7em';
                            dayElement.appendChild(negativeIndicator);
                        }
                    }

                    dayElement.addEventListener('click', () => openDayModal(day, currentMonth, currentYear));
                    calendarDays.appendChild(dayElement);
                }
            }

            function openDayModal(day, month, year) {
                selectedDay = { day, month, year };
                const dateKey = `${year}-${month}-${day}`;
                const dayData = getDayData(dateKey) || {};

                modalDayTitle.textContent = `Day Details: ${day} ${getMonthName(month)} ${year}`;

                // Reset all inputs
                sleepSlider.value = dayData.sleep || 7;
                sleepValueDisplay.textContent = parseFloat(sleepSlider.value).toFixed(1) + ' hrs';

                moodSlider.value = dayData.mood || 5;
                moodValueDisplay.textContent = moodSlider.value;

                activitySlider.value = dayData.activity || 5;
                activityValueDisplay.textContent = activitySlider.value;

                dayNotes.value = dayData.notes || '';

                // Reset all buttons
                document.querySelectorAll('.notion-button').forEach(btn => btn.classList.remove('selected'));

                // Select water intake button
                if (dayData.water) {
                    const waterButton = waterIntakeButtons.querySelector(`[data-value="${dayData.water}"]`);
                    if (waterButton) waterButton.classList.add('selected');
                }

                // Select nutrition buttons
                selectButtonsInGroup(nutritionMacrosButtons, dayData.nutritionMacros);
                selectButtonsInGroup(nutritionQualityButtons, dayData.nutritionQuality);
                selectButtonsInGroup(nutritionStimulantsButtons, dayData.nutritionStimulants);

                // Select symptoms buttons
                selectButtonsInGroup(symptomsCoreButtons, dayData.symptomsCore);
                selectButtonsInGroup(symptomsGIButtons, dayData.symptomsGI);
                selectButtonsInGroup(symptomsImmunityButtons, dayData.symptomsImmunity);
                selectButtonsInGroup(symptomsSkinHairButtons, dayData.symptomsSkinHair);
                selectButtonsInGroup(symptomsEnergyButtons, dayData.symptomsEnergy);
                selectButtonsInGroup(symptomsMentalButtons, dayData.symptomsMental);

                // Select sleep quality buttons
                selectButtonsInGroup(sleepQualityButtons, dayData.sleepQuality);

                // Select activity issues buttons
                selectButtonsInGroup(activityIssuesButtons, dayData.activityIssues);

                // Show modal
                dayModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';

                // Анимация появления элементов
                animateModalElements();
            }

            function animateModalElements() {
                const sections = document.querySelectorAll('.modal-section');
                const buttons = document.querySelectorAll('.notion-button');
                const textarea = document.querySelector('.notion-textarea');
                const saveBtn = document.querySelector('.save-day-btn');

                // Сначала скрываем все элементы
                sections.forEach(section => section.classList.remove('visible'));
                buttons.forEach(btn => btn.classList.remove('visible'));
                textarea.classList.remove('visible');
                saveBtn.classList.remove('visible');

                // Анимируем появление секций с задержкой
                sections.forEach((section, index) => {
                    setTimeout(() => {
                        section.classList.add('visible');
                    }, 100 + index * 50);
                });

                // Анимируем появление кнопок с задержкой
                buttons.forEach((button, index) => {
                    setTimeout(() => {
                        button.classList.add('visible');
                    }, 300 + index * 20);
                });

                // Анимируем появление textarea
                setTimeout(() => {
                    textarea.classList.add('visible');
                }, 500);

                // Анимируем появление кнопки сохранения
                setTimeout(() => {
                    saveBtn.classList.add('visible');
                }, 600);
            }

            function selectButtonsInGroup(buttonGroup, values) {
                if (!values || !Array.isArray(values)) return;
                const buttons = buttonGroup.querySelectorAll('.notion-button');
                buttons.forEach(button => {
                    if (values.includes(button.dataset.value)) {
                        button.classList.add('selected');
                    }
                });
            }

            function saveDayData() {
                if (!selectedDay) return;

                const dateKey = `${selectedDay.year}-${selectedDay.month}-${selectedDay.day}`;

                const dayData = {
                    sleep: parseFloat(sleepSlider.value),
                    water: getSelectedButtonValue(waterIntakeButtons),
                    nutritionMacros: getSelectedButtonValues(nutritionMacrosButtons),
                    nutritionQuality: getSelectedButtonValues(nutritionQualityButtons),
                    nutritionStimulants: getSelectedButtonValues(nutritionStimulantsButtons),
                    mood: parseInt(moodSlider.value),
                    symptomsCore: getSelectedButtonValues(symptomsCoreButtons),
                    symptomsGI: getSelectedButtonValues(symptomsGIButtons),
                    symptomsImmunity: getSelectedButtonValues(symptomsImmunityButtons),
                    symptomsSkinHair: getSelectedButtonValues(symptomsSkinHairButtons),
                    symptomsEnergy: getSelectedButtonValues(symptomsEnergyButtons),
                    symptomsMental: getSelectedButtonValues(symptomsMentalButtons),
                    sleepQuality: getSelectedButtonValues(sleepQualityButtons),
                    activity: parseInt(activitySlider.value),
                    activityIssues: getSelectedButtonValues(activityIssuesButtons),
                    notes: dayNotes.value
                };

                localStorage.setItem(dateKey, JSON.stringify(dayData));
                showToast('Day data saved successfully!');
                renderCalendar();
                dayModal.style.display = 'none';
                document.body.style.overflow = '';
            }

            function getSelectedButtonValue(buttonGroup) {
                const selectedButton = buttonGroup.querySelector('.notion-button.selected');
                return selectedButton ? selectedButton.dataset.value : null;
            }

            function getSelectedButtonValues(buttonGroup) {
                const selectedButtons = buttonGroup.querySelectorAll('.notion-button.selected');
                return Array.from(selectedButtons).map(btn => btn.dataset.value);
            }

            function getDayData(dateKey) {
                const data = localStorage.getItem(dateKey);
                return data ? JSON.parse(data) : null;
            }

            function getMonthName(monthIndex) {
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                return months[monthIndex];
            }

            function showToast(message) {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                toastContainer.appendChild(toast);

                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
        });
    </script>
</body>
</html>