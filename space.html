<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PWBVFG5DVZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-PWBVFG5DVZ');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Space</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #000;
            --secondary-color: #000;
            --accent-color: #000;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-image: linear-gradient(#808080, #424242); /* Замените на URL вашего изображения */
            padding: 20px;
            width: 100vw;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
            font-weight: 700;
        }

        /* Updated .section styles - now the main container for each zone */
        .section {
            .section

        {
            margin-bottom: 20px;
            border-radius: 30px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.6);
            background-color: #242424;
            padding: 20px;
            width: 100%; /* Изменено с 99% на 100% */
        }

        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
        }

        /* Zone 3 - Calendar */
        .calendar {
            width: 100%;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-title {
            font-size: 1.3rem;
            font-weight: 500;
            color: var(--primary-color);
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav-btn {
            padding: 5px 10px;
            border: none;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

            .calendar-nav-btn:hover {
                background-color: var(--secondary-color);
            }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 500;
            padding: 10px;
            color: var(--secondary-color);
        }

        .calendar-day {
            aspect-ratio: 1;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 5px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid black;
        }

            .calendar-day:hover {
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

        .calendar-day-number {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .day-mood {
            width: 100%;
            margin: 5px 0;
        }

        .day-checkbox {
            display: flex;
            align-items: center;
            margin: 3px 0;
            font-size: 0.8rem;
        }

            .day-checkbox input {
                margin-right: 5px;
            }

        .day-note {
            width: 100%;
            font-size: 0.7rem;
            padding: 3px;
            border: 1px solid #eee;
            border-radius: 4px;
            resize: none;
            height: 40px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 30px;
            box-shadow: var(--box-shadow);
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            color: var(--primary-color);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--secondary-color);
        }

        .mood-slider-container {
            margin: 20px 0;
        }

        .mood-slider {
            width: 100%;
        }

        .mood-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            color: var(--secondary-color);
        }

        .modal-checkboxes {
            margin: 20px 0;
        }

        .modal-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

            .modal-checkbox input {
                margin-right: 10px;
            }

        .modal-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            resize: vertical;
            min-height: 100px;
            margin-top: 10px;
        }

        .save-day-btn {
            width: 100%;
            padding: 25px;
            border: none;
            border-radius: 20px;
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 20px;
        }

            .save-day-btn:hover {
                background-color: var(--secondary-color);
            }

        /* Responsive Calendar styles (unchanged) */
        @media (max-width: 768px) {
            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
            }

            .calendar-day-number {
                font-size: 0.8rem;
            }

            .day-note {
                display: none;
            }
        }

        @media (max-width: 4800px) { /* This media query seems to be for very large screens or a typo, consider adjusting */
            .calendar-day-header {
                font-size: 0.7rem;
                padding: 5px;
            }

            .calendar-day {
                padding: 2px;
            }

            .calendar-day-number {
                font-size: 0.7rem;
            }

            .day-mood {
                display: none;
            }

            .day-checkbox {
                font-size: 0.6rem;
            }
        }

        .day-indicators {
            display: flex;
            justify-content: center;
            gap: -1px;
            margin-top: -5px;
        }

            .day-indicators span {
                font-size: 0.8em;
                width: 16px;
                height: 16px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                background-color: rgba(74, 111, 165, 0.1);
            }

        .indicator-calories {
            color: var(--success-color);
        }

        .indicator-macros {
            color: var(--success-color);
        }

        /* На десктопах можно показывать больше информации */
        @media (min-width: 768px) {
            .day-indicators {
                flex-direction: column;
                gap: 2px;
            }

                .day-indicators span {
                    width: auto;
                    height: auto;
                    background: none;
                    font-size: 0.7em;
                    justify-content: flex-start;
                    padding-left: 2px;
                }

            .indicator-calories::before {
                content: 'Calories: ';
            }

            .indicator-macros::before {
                content: 'Macros: ';
            }
        }

        #toast-container {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 320px;
            pointer-events: none;
        }
        /* Само уведомление */
        .toast {
            background-color: #333;
            color: #fff;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            font-size: 16px;
            opacity: 0;
            animation: slideDown 0.3s forwards, fadeOut 0.3s forwards 2.7s;
            pointer-events: auto;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        label {
            font-size: 20px;
            display: block;
            margin-bottom: 20px;
        }

        input[type=range] {
            width: 300px;
            margin-bottom: 30px;
        }

        #valueDisplay {
            font-weight: bold;
            font-size: 24px;
            margin-top: -45px;
            width: 50%;
        }

        #saveBtn {
            padding: 15px 25px;
            border: none;
            background-color: #000000;
            color: white;
            border-radius: 15px;
            cursor: pointer;
            font-size: 15px;
            margin-left: 130px;
        }

        #calories-checkbox, #macros-checkbox {
            margin-top: -20px;
        }

        .mood-slider {
            min-width: 100%;
        }

        #sleepRange {
            min-width: 100%;
        }

        /* New Body State Section Styles */
        .body-state-overview {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
        }

        .progress-circle-container {
            position: relative;
            width: 170px;
            height: 170px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 500px;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 1);
            top: 10px;
            margin-bottom: 10px;
        }

        .progress-circle {
            transform: rotate(-90deg); /* Start from top */
        }

        .progress-circle-background { /* Changed from progress-circle-bg to match HTML */
            fill: none;
            stroke: black;
            stroke-width: 10; /* Adjusted to match HTML */
        }

        .progress-circle-progress {
            fill: none;
            stroke: white; /* Use primary color for progress */
            stroke-width: 20;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease-in-out;
            stroke-dasharray: 314.159; /* Added: Circumference for r=50 (2 * PI * 50) */
        }

        .progress-circle-text {
            position: absolute;
            font-size: 3.5rem;
            font-weight: 700;
            color: white;
        }

        /* Always 2x2 grid for body state items */
        .body-state-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Always 2 columns */
            gap: 15px; /* Adjusted gap for mobile-first */
        }

        .body-state-item {
            background-color: #3b3b3b;
            border: 0px solid #eee;
            border-radius: 20px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            aspect-ratio: 1 / 1;
            justify-content: space-between; /* Distribute content vertically */
        }

            .body-state-item label {
                font-size: 0.9rem;
                font-weight: 500;
                color: white;
                margin-bottom: 0; /* Override default label margin */
            }

            .body-state-item input[type="range"],
            .body-state-item textarea {
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: var(--border-radius);
                font-size: 0.9rem;
            }

            .body-state-item textarea {
                min-height: 50px;
                resize: vertical;
            }

            .body-state-item .norm-indicator {
                font-size: 0.8rem;
                font-weight: 500;
                text-align: right;
                min-height: 1.2em; /* Ensure consistent height */
            }

        .norm-indicator.good {
            color: var(--success-color);
        }

        .norm-indicator.average {
            color: var(--warning-color);
        }

        .norm-indicator.bad {
            color: var(--danger-color);
        }

        .full-width {
            grid-column: 1 / -1; /* Span across all columns */
        }

        /* Adjust existing styles for better integration */
        .section {
            margin-bottom: 20px;
            border-radius: 30px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.6);
            background-color: #242424;
            padding: 20px;
            width: 100%; /* Изменено с 99% на 100% */
        }


        /* Styles for range inputs */
        .body-state-item input[type="range"] {
            width: 100%;
            -webkit-appearance: none; /* Remove default styling */
            appearance: none;
            height: 8px;
            background: #38960c;
            border: none;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            border-radius: 8px;
            margin-bottom: 0; /* Remove default margin */
            margin-top: 10px;
        }

            .body-state-item input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: var(--primary-color);
                cursor: pointer;
            }

            .body-state-item input[type="range"]::-moz-range-thumb {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: var(--primary-color);
                cursor: pointer;
            }

        .range-value {
            font-size: 0.8rem;
            font-weight: 500;
            text-align: right;
            color: white;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- New Body State Section -->
        <div class="section">
            <div class="body-state-overview">
                <div class="progress-circle-container">
                    <svg width="170" height="170" viewBox="0 0 120 120">
                        <circle class="progress-circle-background" cx="60" cy="60" r="50" stroke="lightgray" stroke-width="10" fill="none" />
                        <circle class="progress-circle-progress" cx="60" cy="60" r="50" stroke="var(--primary-color)" stroke-width="20" fill="none" />
                    </svg>
                    <div class="progress-circle-text" id="body-state-score">0</div>
                </div>
            </div>

            <div class="body-state-grid">
                <div class="body-state-item">
                    <img src="PNGs/height.png" style="height: 40px; width: 40px;"/>
                    <label style="margin-left: 50px; margin-top: -40px;" for="new-height">Height (cm)</label>
                    <input type="range" id="new-height" min="100" max="220" value="175" step="1">
                    <span class="range-value" id="new-height-value">175 cm</span>
                    <div class="norm-indicator" id="height-norm"></div>
                </div>
                <div class="body-state-item">
                    <img src="PNGs/weight.png" style="height: 40px; width: 40px;" alt="Insulin" />
                    <label style="margin-left: 50px; margin-top: -40px;" for="new-weight">Weight (kg)</label>
                    <input type="range" id="new-weight" min="30" max="150" value="70" step="0.1">
                    <span class="range-value" id="new-weight-value">70.0 kg</span>
                    <div class="norm-indicator" id="weight-norm"></div>
                </div>
                <div class="body-state-item">
                    <img src="PNGs/age.png" style="height: 40px; width: 40px; border-radius: 10px;" alt="Insulin" />
                    <label style="margin-left: 50px; margin-top: -40px;" for="new-age">Age</label>
                    <input type="range" id="new-age" min="1" max="100" value="30" step="1">
                    <span class="range-value" id="new-age-value">30 years</span>
                    <div class="norm-indicator" id="age-norm"></div>
                </div>
                <div class="body-state-item">
                    <img src="PNGs/sleep-space.png" style="height: 40px; width: 40px; border-radius: 10px;" alt="Insulin" />
                    <label style="margin-left: 50px; margin-top: -40px;" for="new-sleep">Avg. Sleep</label>
                    <input type="range" id="new-sleep" min="0" max="12" value="7.5" step="0.1">
                    <span class="range-value" id="new-sleep-value">7.5 hours</span>
                    <div class="norm-indicator" id="sleep-norm"></div>
                </div>
                <div class="body-state-item">
                    <img src="PNGs/water-glass.png" style="height: 40px; width: 40px; border-radius: 10px;" alt="Insulin" />
                    <label style="margin-left: 50px; margin-top: -40px;" for="new-water">Avg. Water</label>
                    <input type="range" id="new-water" min="0" max="5" value="2.0" step="0.1">
                    <span class="range-value" id="new-water-value">2.0 liters</span>
                    <div class="norm-indicator" id="water-norm"></div>
                </div>
                <div class="body-state-item">
                    <img src="PNGs/exercise.png" style="height: 40px; width: 40px; border-radius: 10px;" alt="Insulin" />
                    <label style="margin-left: 50px; margin-top: -40px;" for="new-activity">Activity Level</label>
                    <input type="range" id="new-activity" min="1" max="5" value="3" step="1">
                    <span class="range-value" id="new-activity-value">3</span>
                    <div class="norm-indicator" id="activity-norm"></div>
                </div>
            </div>
        </div>

        <!-- Zone 3: Calendar -->
        <div class="section">
            <h2 class="section-title">Daily Tracking</h2>
            <div class="calendar">
                <div class="calendar-header">
                    <div class="calendar-title" id="current-month-year">June 2023</div>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" id="prev-month">Previous</button>
                        <button class="calendar-nav-btn" id="next-month">Next</button>
                    </div>
                </div>

                <div class="calendar-grid" id="calendar-days-header">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
                </div>

                <div class="calendar-grid" id="calendar-days">
                    <!-- Calendar days will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Day Details Modal -->
    <div class="modal" id="day-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-day-title">Day Details</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="mood-slider-container">
                <label>How did you feel today? (1-10)</label>
                <input type="range" min="1" max="10" value="5" class="mood-slider" id="mood-slider">
                <div class="mood-labels">
                    <span>1 (Bad)</span>
                    <div id="mood-value-display"></div>
                    <span>10 (Great)</span>
                </div>
            </div>

            <label for="sleepRange">How much sleep did you get today?</label>
            <input type="range" id="sleepRange" min="0" max="14" step="0.1" value="7" />
            <div><button id="saveBtn">Save</button><div id="valueDisplay">7.0 hrs</div></div>
            <div id="toast-container"></div>

            <script>
                const sleepRange = document.getElementById('sleepRange');
                const valueDisplay = document.getElementById('valueDisplay');
                const saveBtn = document.getElementById('saveBtn');
                const container = document.getElementById('toast-container');

                // Показываем значение при загрузке
                window.addEventListener('DOMContentLoaded', () => {
                    const savedValue = localStorage.getItem('sleepHours');
                    if (savedValue !== null) {
                        sleepRange.value = savedValue;
                        valueDisplay.textContent = parseFloat(savedValue).toFixed(1) + ' hours';
                    } else {
                        valueDisplay.textContent = sleepRange.value + ' hours';
                    }
                });

                // Обновляем значение при изменении
                sleepRange.addEventListener('input', () => {
                    const val = parseFloat(sleepRange.value);
                    valueDisplay.textContent = val.toFixed(1) + ' hours';
                });

                // Сохраняем уведомление в истории
                function saveNotification(message) {
                    const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
                    notifications.push({
                        text: message,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                }

                // Показываем тост и сохраняем в историю
                function showToast(message) {
                    saveNotification(message);

                    const toast = document.createElement('div');
                    toast.classList.add('toast');
                    toast.textContent = message;
                    container.appendChild(toast);

                    setTimeout(() => {
                        toast.remove();
                    }, 3000);
                }

                // Кнопка сохранить
                saveBtn.addEventListener('click', () => {
                    const val = parseFloat(sleepRange.value);
                    localStorage.setItem('sleepHours', val.toFixed(1));

                    if (val < 7) {
                        showToast('⚠️ Less than 7 hours – try to sleep more!');
                    } else if (val <= 9) {
                        showToast('✅ Great! You slept enough.');
                    } else {
                        showToast('⚠️ Over 9 hours – maybe too much rest.');
                    }
                });
            </script>

            <br>
            <div class="modal-checkboxes">
                <div class="modal-checkbox">
                    <input type="checkbox" id="calories-checkbox">
                    <label for="calories-checkbox">Met calories & macros goal</label>
                </div>
                <div class="modal-checkbox">
                    <input type="checkbox" id="macros-checkbox">
                    <label for="macros-checkbox">
                        Met
                        <a href="space.html" style="font-size:1rem;font-weight:bold;text-transform:uppercase;background:linear-gradient(#3333ff,#00ffcc);background-size:400%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none;display:inline-block;">WATER</a>
                        goal
                    </label>
                </div>
            </div>
            <div>
                <label for="day-notes">Notes</label>
                <textarea class="modal-textarea" id="day-notes" placeholder="Write your notes for the day..."></textarea>
            </div>
            <button class="save-day-btn" id="save-day-btn">Save Day</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Current date
            let currentDate = new Date();
            let currentYear = currentDate.getFullYear();
            let currentMonth = currentDate.getMonth();
            let selectedDay = null;

            // DOM Elements for Calendar and Modal (unchanged)
            const currentMonthYear = document.getElementById('current-month-year');
            const calendarDays = document.getElementById('calendar-days');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const dayModal = document.getElementById('day-modal');
            const modalDayTitle = document.getElementById('modal-day-title');
            const moodSlider = document.getElementById('mood-slider');
            const moodValueDisplay = document.getElementById('mood-value-display');
            const caloriesCheckbox = document.getElementById('calories-checkbox');
            const macrosCheckbox = document.getElementById('macros-checkbox');
            const dayNotes = document.getElementById('day-notes');
            const saveDayBtn = document.getElementById('save-day-btn');
            const closeModal = document.querySelector('.close-modal');

            // New DOM Elements for Body State Section
            const bodyStateScoreDisplay = document.getElementById('body-state-score');
            const progressCircle = document.querySelector('.progress-circle-progress');
            const newHeightInput = document.getElementById('new-height');
            const newWeightInput = document.getElementById('new-weight');
            const newAgeInput = document.getElementById('new-age');
            const newSleepInput = document.getElementById('new-sleep');
            const newWaterInput = document.getElementById('new-water');
            const newActivityInput = document.getElementById('new-activity');

            const heightNorm = document.getElementById('height-norm');
            const weightNorm = document.getElementById('weight-norm');
            const ageNorm = document.getElementById('age-norm');
            const sleepNorm = document.getElementById('sleep-norm');
            const waterNorm = document.getElementById('water-norm');
            const activityNorm = document.getElementById('activity-norm');

            // New elements for range value displays
            const newHeightValue = document.getElementById('new-height-value');
            const newWeightValue = document.getElementById('new-weight-value');
            const newAgeValue = document.getElementById('new-age-value');
            const newSleepValue = document.getElementById('new-sleep-value');
            const newWaterValue = document.getElementById('new-water-value');
            const newActivityValue = document.getElementById('new-activity-value');


            // Load saved data from localStorage
            loadData();

            // Event Listeners for Body State Section
            newHeightInput.addEventListener('input', () => {
                newHeightValue.textContent = `${newHeightInput.value} cm`;
                updateBodyState();
            });
            newWeightInput.addEventListener('input', () => {
                newWeightValue.textContent = `${parseFloat(newWeightInput.value).toFixed(1)} kg`;
                updateBodyState();
            });
            newAgeInput.addEventListener('input', () => {
                newAgeValue.textContent = `${newAgeInput.value} years`;
                updateBodyState();
            });
            newSleepInput.addEventListener('input', () => {
                newSleepValue.textContent = `${parseFloat(newSleepInput.value).toFixed(1)} hours`;
                updateBodyState();
            });
            newWaterInput.addEventListener('input', () => {
                newWaterValue.textContent = `${parseFloat(newWaterInput.value).toFixed(1)} liters`;
                updateBodyState();
            });
            newActivityInput.addEventListener('input', () => {
                newActivityValue.textContent = newActivityInput.value;
                updateBodyState();
            });


            // Event Listeners for Calendar (unchanged)
            prevMonthBtn.addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar();
            });

            closeModal.addEventListener('click', () => {
                dayModal.style.display = 'none';
            });

            moodSlider.addEventListener('input', () => {
                moodValueDisplay.textContent = moodSlider.value;
            });

            saveDayBtn.addEventListener('click', saveDayData);

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === dayModal) {
                    dayModal.style.display = 'none';
                }
            });

            // Initialize
            updateBodyState(); // Calculate initial body state score
            renderCalendar();

            // Functions for Body State Section
            function updateBodyState() {
                const height = parseFloat(newHeightInput.value);
                const weight = parseFloat(newWeightInput.value);
                const age = parseFloat(newAgeInput.value);
                const sleep = parseFloat(newSleepInput.value);
                const water = parseFloat(newWaterInput.value);
                const activity = parseFloat(newActivityInput.value);

                let score = 0;
                let criteriaMet = 0;
                // const totalCriteria = 6; // This variable is no longer directly used for normalization denominator

                // Height (example: 150-190 cm is good)
                if (!isNaN(height)) {
                    if (height >= 150 && height <= 190) {
                        score += 15;
                        heightNorm.textContent = 'Good';
                        heightNorm.className = 'norm-indicator good';
                    } else if (height > 190 || height < 150) {
                        score += 5;
                        heightNorm.textContent = 'Average';
                        heightNorm.className = 'norm-indicator average';
                    } else { // Bad range
                        score += 0; // Explicitly add 0 for bad, or just don't add
                        heightNorm.textContent = 'Bad';
                        heightNorm.className = 'norm-indicator bad';
                    }
                    criteriaMet++;
                } else {
                    heightNorm.textContent = '';
                    heightNorm.className = 'norm-indicator';
                }

                // Weight (example: BMI calculation for norm)
                if (!isNaN(height) && !isNaN(weight)) {
                    const heightInMeters = height / 100;
                    const bmi = weight / (heightInMeters * heightInMeters);
                    if (bmi >= 18.5 && bmi < 25) {
                        score += 15;
                        weightNorm.textContent = 'Good (BMI: ' + bmi.toFixed(1) + ')';
                        weightNorm.className = 'norm-indicator good';
                    } else if ((bmi >= 25 && bmi < 30) || (bmi >= 17 && bmi < 18.5)) {
                        score += 10;
                        weightNorm.textContent = 'Average (BMI: ' + bmi.toFixed(1) + ')';
                        weightNorm.className = 'norm-indicator average';
                    } else {
                        score += 0; // Explicitly add 0 for bad
                        weightNorm.textContent = 'Bad (BMI: ' + bmi.toFixed(1) + ')';
                        weightNorm.className = 'norm-indicator bad';
                    }
                    criteriaMet++;
                } else {
                    weightNorm.textContent = '';
                    weightNorm.className = 'norm-indicator';
                }

                // Age (example: 20-60 is good)
                if (!isNaN(age)) {
                    if (age >= 20 && age <= 60) {
                        score += 10; // Max 10 for Age
                        ageNorm.textContent = 'Good';
                        ageNorm.className = 'norm-indicator good';
                    } else if (age > 60 || age < 20) {
                        score += 5;
                        ageNorm.textContent = 'Average';
                        ageNorm.className = 'norm-indicator average';
                    } else { // Bad range
                        score += 0; // Explicitly add 0 for bad
                        ageNorm.textContent = 'Bad';
                        ageNorm.className = 'norm-indicator bad';
                    }
                    criteriaMet++;
                } else {
                    ageNorm.textContent = '';
                    ageNorm.className = 'norm-indicator';
                }

                // Sleep (example: 7-9 hours is good)
                if (!isNaN(sleep)) {
                    if (sleep >= 7 && sleep <= 9) {
                        score += 15;
                        sleepNorm.textContent = 'Good';
                        sleepNorm.className = 'norm-indicator good';
                    } else if ((sleep >= 6 && sleep < 7) || (sleep > 9 && sleep <= 10)) {
                        score += 10;
                        sleepNorm.textContent = 'Average';
                        sleepNorm.className = 'norm-indicator average';
                    } else {
                        score += 0; // Explicitly add 0 for bad
                        sleepNorm.textContent = 'Bad';
                        sleepNorm.className = 'norm-indicator bad';
                    }
                    criteriaMet++;
                } else {
                    sleepNorm.textContent = '';
                    sleepNorm.className = 'norm-indicator';
                }

                // Water (example: 1.5-3.0 liters is good)
                if (!isNaN(water)) {
                    if (water >= 1.5 && water <= 3.0) {
                        score += 15;
                        waterNorm.textContent = 'Good';
                        waterNorm.className = 'norm-indicator good';
                    } else if ((water >= 1.0 && water < 1.5) || (water > 3.0 && water <= 4.0)) {
                        score += 10;
                        waterNorm.textContent = 'Average';
                        waterNorm.className = 'norm-indicator average';
                    } else {
                        score += 0; // Explicitly add 0 for bad
                        waterNorm.textContent = 'Bad';
                        waterNorm.className = 'norm-indicator bad';
                    }
                    criteriaMet++;
                } else {
                    waterNorm.textContent = '';
                    waterNorm.className = 'norm-indicator';
                }

                // Activity Level (example: 3-5 is good)
                if (!isNaN(activity)) {
                    if (activity >= 3 && activity <= 5) {
                        score += 15;
                        activityNorm.textContent = 'Good';
                        activityNorm.className = 'norm-indicator good';
                    } else if (activity === 2) {
                        score += 10;
                        activityNorm.textContent = 'Average';
                        activityNorm.className = 'norm-indicator average';
                    } else {
                        score += 0; // Explicitly add 0 for bad
                        activityNorm.textContent = 'Bad';
                        activityNorm.className = 'norm-indicator bad';
                    }
                    criteriaMet++;
                } else {
                    activityNorm.textContent = '';
                    activityNorm.className = 'norm-indicator';
                }

                // Normalize score to 0-100 range based on criteria met
                let finalScore = 0;
                // Calculate the true maximum possible score based on individual criterion maxes
                const maxPossibleScore = 15 + 15 + 10 + 15 + 15 + 15; // Sum of max scores for each criterion (85)

                if (criteriaMet > 0) {
                    finalScore = Math.round((score / maxPossibleScore) * 100);
                    // Ensure score doesn't exceed 100 due to rounding or edge cases
                    if (finalScore > 100) finalScore = 100;
                }


                bodyStateScoreDisplay.textContent = finalScore;
                const radius = 50; // Match the SVG circle's radius
                const circumference = 2 * Math.PI * radius; // Calculate based on the actual SVG radius
                const offset = circumference - (finalScore / 100) * circumference;
                progressCircle.style.strokeDashoffset = offset;

                saveData();
            }


            function renderCalendar() {
                // Set month and year title
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                currentMonthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;

                // Get first day of month and total days in month
                const firstDay = new Date(currentYear, currentMonth, 1).getDay();
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

                // Clear previous calendar days
                calendarDays.innerHTML = '';

                // Add empty cells for days before the first day of the month
                for (let i = 0; i < firstDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day empty';
                    calendarDays.appendChild(emptyDay);
                }

                // Add cells for each day of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.dataset.day = day;
                    dayElement.dataset.month = currentMonth;
                    dayElement.dataset.year = currentYear;

                    // Check if this is today
                    const today = new Date();
                    if (currentYear === today.getFullYear() && currentMonth === today.getMonth() && day === today.getDate()) {
                        dayElement.classList.add('today');
                    }

                    // Add day number
                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'calendar-day-number';
                    dayNumber.textContent = day;
                    dayElement.appendChild(dayNumber);

                    // Load saved data for this day if exists
                    const dateKey = `${currentYear}-${currentMonth}-${day}`;
                    const dayData = getDayData(dateKey);

                    if (dayData) {
                        // Add mood indicator
                        if (dayData.mood) {
                            const moodIndicator = document.createElement('input');
                            moodIndicator.type = 'range';
                            moodIndicator.className = 'day-mood';
                            moodIndicator.min = '1';
                            moodIndicator.max = '10';
                            moodIndicator.value = dayData.mood;
                            moodIndicator.disabled = true;
                            dayElement.appendChild(moodIndicator);
                        }

                        if (dayData.caloriesMet || dayData.macrosMet) {
                            const indicators = document.createElement('div');
                            indicators.className = 'day-indicators';

                            if (dayData.caloriesMet) {
                                indicators.innerHTML += '<span class="indicator-calories" title="Calories goal met">✓</span>';
                            }
                            if (dayData.macrosMet) {
                                indicators.innerHTML += '<span class="indicator-macros" title="Macros goal met">✓</span>';
                            }

                            dayElement.appendChild(indicators);
                        }

                        // Add note preview if exists
                        if (dayData.notes) {
                            const notePreview = document.createElement('textarea');
                            notePreview.className = 'day-note';
                            notePreview.value = dayData.notes;
                            notePreview.disabled = true;
                            dayElement.appendChild(notePreview);
                        }
                    }

                    // Add click event
                    dayElement.addEventListener('click', () => openDayModal(day, currentMonth, currentYear));

                    calendarDays.appendChild(dayElement);
                }
            }

            function openDayModal(day, month, year) {
                selectedDay = { day, month, year };
                const dateKey = `${year}-${month}-${day}`;
                const dayData = getDayData(dateKey);

                // Set modal title
                const date = new Date(year, month, day);
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                modalDayTitle.textContent = date.toLocaleDateString('en-US', options);

                // Set values from saved data or defaults
                if (dayData) {
                    moodSlider.value = dayData.mood || 5;
                    caloriesCheckbox.checked = dayData.caloriesMet || false;
                    macrosCheckbox.checked = dayData.macrosMet || false;
                    dayNotes.value = dayData.notes || '';
                } else {
                    moodSlider.value = 5;
                    caloriesCheckbox.checked = false;
                    macrosCheckbox.checked = false;
                    dayNotes.value = '';
                }

                moodValueDisplay.textContent = moodSlider.value;
                dayModal.style.display = 'flex';
            }

            function saveDayData() {
                if (!selectedDay) return;

                const dateKey = `${selectedDay.year}-${selectedDay.month}-${selectedDay.day}`;
                const dayData = {
                    mood: parseInt(moodSlider.value),
                    caloriesMet: caloriesCheckbox.checked,
                    macrosMet: macrosCheckbox.checked,
                    notes: dayNotes.value
                };

                // Save to localStorage
                const allDaysData = JSON.parse(localStorage.getItem('daysData')) || {};
                allDaysData[dateKey] = dayData;
                localStorage.setItem('daysData', JSON.stringify(allDaysData));

                // Close modal and refresh calendar
                dayModal.style.display = 'none';
                renderCalendar();
            }

            function getDayData(dateKey) {
                const allDaysData = JSON.parse(localStorage.getItem('daysData')) || {};
                return allDaysData[dateKey];
            }

            function saveData() {
                const data = {
                    // Body State Data
                    height: newHeightInput.value,
                    weight: newWeightInput.value,
                    age: newAgeInput.value,
                    sleep: newSleepInput.value,
                    water: newWaterInput.value,
                    activity: newActivityInput.value,
                    bodyStateScore: bodyStateScoreDisplay.textContent
                };

                localStorage.setItem('healthData', JSON.stringify(data));
            }

            function loadData() {
                const savedData = JSON.parse(localStorage.getItem('healthData'));
                if (!savedData) {
                    // Initialize range values if no saved data
                    newHeightValue.textContent = `${newHeightInput.value} cm`;
                    newWeightValue.textContent = `${parseFloat(newWeightInput.value).toFixed(1)} kg`;
                    newAgeValue.textContent = `${newAgeInput.value} years`;
                    newSleepValue.textContent = `${parseFloat(newSleepInput.value).toFixed(1)} hours`;
                    newWaterValue.textContent = `${parseFloat(newWaterInput.value).toFixed(1)} liters`;
                    newActivityValue.textContent = newActivityInput.value;
                    updateBodyState(); // Calculate initial score
                    return;
                }

                // Load Body State Data
                newHeightInput.value = savedData.height || newHeightInput.value;
                newWeightInput.value = savedData.weight || newWeightInput.value;
                newAgeInput.value = savedData.age || newAgeInput.value;
                newSleepInput.value = savedData.sleep || newSleepInput.value;
                newWaterInput.value = savedData.water || newWaterInput.value;
                newActivityInput.value = savedData.activity || newActivityInput.value;

                // Update display values for range inputs
                newHeightValue.textContent = `${newHeightInput.value} cm`;
                newWeightValue.textContent = `${parseFloat(newWeightInput.value).toFixed(1)} kg`;
                newAgeValue.textContent = `${newAgeInput.value} years`;
                newSleepValue.textContent = `${parseFloat(newSleepInput.value).toFixed(1)} hours`;
                newWaterValue.textContent = `${parseFloat(newWaterInput.value).toFixed(1)} liters`;
                newActivityValue.textContent = newActivityInput.value;

                // Update Body State UI after loading
                updateBodyState();
            }
        });
    </script>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

</body>
</html>
